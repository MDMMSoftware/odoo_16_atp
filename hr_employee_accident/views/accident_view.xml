<?xml version="1.0" encoding="utf-8"?>
<odoo>
	<data>
        <record id="hr_employee_accident_view_kanban" model="ir.ui.view">
            <field name="name">employee.accident.kanban</field>
            <field name="model">employee.accident</field>
            <field name="arch" type="xml">
                <kanban class="o_kanban_mobile accident_kanban_box" create="false" delete="false">
                    <field name="id"/>
                    <field name="employee_id"/>
                    <field name="department_id"/>
                    <field name="reason"/>
                    <field name="state"/>
                    <field name="accident_date"/>
                    <progressbar field="state" colors='{"done": "success", "blocked": "danger"}'/>
                    <templates>
                        <t t-name="kanban-box" class="accident_kanban">
                            <div class="oe_kanban_global_click o_hr_kanban_record">
                                <strong class="o_kanban_record_title">
                                    <field name="name"/>
                                </strong>

                                <div class="oe_kanban_details">
                                    <div class="o_kanban_record_top">
                                        <div class="o_kanban_record_headings">
                                            <strong class="o_kanban_record_title">
                                                <field name="employee_id"/>
                                            </strong>
                                        </div>
                                    </div>
                                    <div class="o_kanban_record_top">
                                        <div class="o_kanban_record_headings">
                                            <strong class="o_kanban_record_title">
                                                <field name="reason"/>
                                            </strong>

                                        </div>
                                    </div>
                                    <div class="o_kanban_record_bottom">
                                        <div class="oe_kanban_bottom_left text-muted">
                                            
                                            <span><field name="accident_date"/></span>
                                            
                                        </div>
                                        <div class="oe_kanban_bottom_right">
                                            <b><li t-if="record.state.raw_value=='draft'" style="color:grey;"><field name="state"/></li></b>
                                            <b><li t-if="record.state.raw_value=='report'" style="color:orange;"><field name="state"/></li></b>
                                            <b><li t-if="record.state.raw_value=='inquiry'" style="color:#8bb005;"><field name="state"/></li></b>
                                            <b><li t-if="record.state.raw_value=='meeting'" style="color:purple;"><field name="state"/></li></b>
                                            <b><li t-if="record.state.raw_value=='processing'" style="color:blue;"><field name="state"/></li></b>
                                            <b><li t-if="record.state.raw_value=='complete'" style="color:green;"><field name="state"/></li></b>


                                            <!-- <li t-if="record.description.raw_value" ><field name="description" /></li> -->
                                            <!-- <t t-if="record.state.raw_value"><span t-attf-class="badge #{ ['draft'].indexOf(record.state.raw_value) &gt; -1 ? 'bg-200' : ['done'].indexOf(record.state.raw_value) &gt; -1 ? 'bg-success' : 'bg-primary'}"><t t-esc="record.state.value"/></span></t> -->
                                            <!-- <li t-if="record.state.raw_value=='progress'" style="color:orange;"><field name="state"/></li>
                                            <li t-if="record.state.raw_value=='ready'" style="color:blue;"><field name="state"/></li> -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <record id="hr_employee_accident_tree_view" model="ir.ui.view">
            <field name="name">employee.accident.tree.view</field>
            <field name="model">employee.accident</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="name"/>
                    <field name="employee_id"/>
                    <field name="accident_date"/>
                    <field name="location"/>
                    <field name="reason"/>
                    <field name="state" widget="badge" decoration-success="state=='done'" decoration-info="state=='draft'"/>
                </tree>
            </field>
        </record>
        <record id="hr_employee_accident_form" model="ir.ui.view">
            <field name="name">Employee Accident Form</field>
            <field name="model">employee.accident</field>
            <field name="arch" type="xml">
                <form>
                    <header>
                        <button string="Report" type="object" attrs="{'invisible':[('state','!=','draft')]}" name="action_report" class="oe_highlight"/>
                        <button string="Inquiry" type="object" attrs="{'invisible':[('state','!=','report')]}" name="action_inquiry" class="oe_highlight"/>
                        <button string="Meeting" type="object" attrs="{'invisible':[('state','!=','inquiry')]}" name="action_meeting" class="oe_highlight"/>
                        <button string="Processing" type="object" attrs="{'invisible':[('state','!=','meeting')]}" name="action_processing" class="oe_highlight"/>
                        <button string="Complete" type="object" attrs="{'invisible':[('state','!=','processing')]}" name="action_complete" class="oe_highlight"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,report,inquiry,meeting,processing,complete"/>
                    </header>
                    <sheet>
                        <div name="button_box" class="oe_button_box">
                                <button name="action_open_deduction_form" class="oe_stat_button" icon="fa-usd" type="object" string="Deduction"/>  
                        </div>
                       <div class="oe_title">
                            <h1>
                                <field name="name" readonly="1"/>
                            </h1>
                            <h3>
                            <group>
                                <field name="reference" attrs="{'readonly':[('state','!=','draft')]}"/>
                            </group>
                            </h3>
                        </div>
                        <group string="Employee Information" readonly="1">
                          <group col="2">
                            <field name="employee_id" required="1" attrs="{'readonly':[('state','!=','draft')]}" options="{'no_quick_create': True, 'no_create_edit' : True}"/>
                            <field name="employee_nrc" force_save="1" attrs="{'readonly':[('state','!=','draft')]}"/>
                            <field name="employee_phone" force_save="1" required="1" attrs="{'readonly':[('state','!=','draft')]}"/>

                          </group>
                          <group col="2">
                            <field name="department_id" force_save="1" required="1" readonly="1"/>
                            <field name="employee_job_position" force_save="1" required="1" readonly="1"/>
                          </group>
                        </group>
                        
                        <notebook>
                            <page name="accident_information" string="Accident Information">
                              <group>
                              <group col="2">
                                <field name="site_manager_id" attrs="{'required':[('state','!=','draft')],'readonly':[('state','not in',('draft','report'))]}" options="{'no_quick_create': True, 'no_create_edit' : True}"/>
                                <field name="accident_date" attrs="{'required':[('state','!=','draft')],'readonly':[('state','not in',('draft','report'))]}"/>
                                <field name="location" attrs="{'required':[('state','!=','draft')],'readonly':[('state','not in',('draft','report'))]}"/>
                                <field name="reason" attrs="{'required':[('state','!=','draft')],'readonly':[('state','not in',('draft','report'))]}"/>
                                <field name="damages" attrs="{'required':[('state','!=','draft')],'readonly':[('state','not in',('draft','report'))]}"/>
                              </group>
                              <group col="2">
                                <field name="accident_type_id" options="{'no_quick_create': True, 'no_create_edit' : True}"/>
                                <field name="witness_person" attrs="{'readonly':[('state','not in',('draft','report'))]}" />
                                <!-- <field name="witness_ids" widget="many2many_tags" attrs="{'required':[('state','!=','draft')],'readonly':[('state','not in',('draft','report'))]}" options="{'no_quick_create': True, 'no_create_edit' : True}"/> -->
                                <field name="cost_and_compensation_responsible_ids" widget="many2many_tags" attrs="{'readonly':[('state','not in',('draft','report','meeting'))]}" options="{'no_quick_create': True, 'no_create_edit' : True}"/>
                                <field name="accident_fleet_ids" widget="many2many_tags" attrs="{'readonly':[('state','not in',('draft','report','meeting'))]}" options="{'no_quick_create': True, 'no_create_edit' : True}"/>
                                <field name="documentor_id" attrs="{'required':[('state','!=','draft')],'readonly':[('state','not in',('draft','report'))]}" options="{'no_quick_create': True, 'no_create_edit' : True}"/>
                                <field name="head_of_department_id" attrs="{'required':[('state','!=','draft')],'readonly':[('state','not in',('draft','report'))]}" options="{'no_quick_create': True, 'no_create_edit' : True}"/>
                                <label for="supported_attachment_ids" string="Supporting Document" attrs="{'readonly':[('state','not in',('draft','report'))]}"/>
                                <field name="supported_attachment_ids" widget="many2many_binary" nolabel="1" attrs="{'readonly':[('state','not in',('draft','report'))]}"/>
                              </group>
                            </group>
                            <group>
                              <field name="summary_of_site_manager" required="1" attrs="{'readonly':[('state','!=','draft')]}"/>
                            </group>     
                          </page>
                          <page name="inquiry" string="Follow Up and Inquiry">
                            <group>
                                <field name="inquiry_summary" attrs="{'required':[('state','in',('inquiry',))],'readonly':[('state','not in',('inquiry',))]}"/>
                                <field name="insurance_status" attrs="{'readonly':[('state','not in',('meeting','inquiry'))]}"/>
                                <field name="insurance_claim_status" attrs="{'readonly':[('state','not in',('meeting','inquiry'))],'invisible':[('insurance_status','=',False)]}"/>
                                <field name="insurance_remark" attrs="{'readonly':[('state','not in',('meeting','inquiry'))]}" />
                            </group>
                            <label for="inquiry_attachments" string="Supporting Document" attrs="{'readonly':[('state','not in',('inquiry',))]}"/>
                            <field name="inquiry_attachments" widget="many2many_binary" nolabel="1" attrs="{'readonly':[('state','not in',('inquiry',))]}"/>
                        </page>
                          <page name="meeting" string="BOD Decision">
                            <group>
                                <field name="meeting_of_minutes" attrs="{'required':[('state','in',('meeting','processing'))],'readonly':[('state','not in',('meeting',))]}"/>
                            </group>
                            <group>
                                <group>
                                    <field name="estimate_amt" attrs="{'required':[('state','in',('meeting','processing'))],'readonly':[('state','not in',('meeting',))]}"/>
                                    <field name="actual_amt" attrs="{'required':[('state','in',('meeting','processing'))],'readonly':[('state','not in',('meeting',))]}"/>
                                    <field name="meeting_decision_date" attrs="{'required':[('state','in',('meeting','processing'))],'readonly':[('state','not in',('meeting',))]}"/>
                                </group>
                                <group>
                                    <field name="accident_amt_type" attrs="{'required':[('state','in',('meeting','processing'))],'readonly':[('state','not in',('meeting',))]}"/>

                                    <field name="insurement_amt" attrs="{'required':[('state','in',('meeting','processing'))],'readonly':['|',('state','not in',('meeting',)),('insurance_claim_status','=',False)],'invisible':[('accident_amt_type','=','percentage')]}"/>
                                    <field name="insurement_amt_ratio" attrs="{'required':[('state','in',('meeting','processing'))],'readonly':['|',('state','not in',('meeting',)),('insurance_claim_status','=',False)],'invisible':[('accident_amt_type','!=','percentage')]}"/>

                                    <field name="employee_amt" attrs="{'required':[('state','in',('meeting','processing'))],'readonly':[('state','not in',('meeting',))],'invisible':[('accident_amt_type','=','percentage')]}"/>
                                    <field name="employee_amt_ratio" attrs="{'required':[('state','in',('meeting','processing'))],'readonly':[('state','not in',('meeting',))],'invisible':[('accident_amt_type','!=','percentage')]}"/>

                                    <field name="company_amt" attrs="{'required':[('state','in',('meeting','processing'))],'readonly':[('state','not in',('meeting',))],'invisible':[('accident_amt_type','==','percentage')]}"/>
                                    <field name="company_amt_ratio" attrs="{'required':[('state','in',('meeting','processing'))],'readonly':[('state','not in',('meeting',))],'invisible':[('accident_amt_type','!=','percentage')]}"/>

                                    <field name="other_department_amt" attrs="{'required':[('state','in',('meeting','processing'))],'readonly':[('state','not in',('meeting',))],'invisible':[('accident_amt_type','=','percentage')]}"/>
                                    <field name="other_department_amt_ratio" attrs="{'required':[('state','in',('meeting','processing'))],'readonly':[('state','not in',('meeting',))],'invisible':[('accident_amt_type','!=','percentage')]}"/>

                                </group>
                                <field name="deduction_ids" attrs="{'readonly':[('state','not in',('meeting',))]}">
                                  <tree editable="bottom" create="1">
                                    <field name="employee_id" domain="[('id','in',cost_and_compensation_responsible_ids)]"/>
                                    <field name="total_deduction_amt"/>
                                    <field name="cost_and_compensation_responsible_ids" invisible="1"/>
                                    <button icon="fa-bars" type="object" name="action_open_deduction_line" class="oe_highlight"/>
                                  </tree>
                                </field>
                            </group>
                          </page>
                        </notebook>
                    </sheet>
                </form>
            </field>

        </record>

        <record id="hr_employee_accident_view_search" model="ir.ui.view">
            <field name="name">employee.accident.search</field>
            <field name="model">employee.accident</field>
            <field name="arch" type="xml">
                <search string="Search Employee Accident">
                    <field name="name"/>
                    <field name="employee_id"/>
                    <field name="department_id" operator="child_of"/>
                    <field name="state"/>
    
                    <group expand="0" string="Group By">
                        <filter string="Status" name='group_by_state' domain="[]" context="{'group_by': 'state'}"/>
                    </group>
                </search>
            </field>
        </record>
        <record id="hr_employee_accident_view_action" model="ir.actions.act_window">
            <field name="name">Employee Accident</field>
            <field name="res_model">employee.accident</field>
            <field name="search_view_id" ref="hr_employee_accident_view_search"/>
            <field name="context">{'search_default_group_by_state': 1}</field>
            <field name="view_mode">tree,form,kanban</field>
        </record>

        <record id="accident_type_view_action" model="ir.actions.act_window">
            <field name="name">Accident Type</field>     
            <field name="res_model">hr.employee.accident.type</field>   
            <field name="view_mode">tree</field>
            <!-- <field -->
        </record>

        <record id="accident_type_tree_view" model="ir.ui.view">
            <field name="name">hr.employee.accident.type.tree</field>
            <field name="model">hr.employee.accident.type</field>
            <field name="arch" type="xml">
                <tree string="Accident Type" editable="bottom">
                    <field name="name" />                
                </tree>
            </field>
        </record>

    </data>

    

</odoo>